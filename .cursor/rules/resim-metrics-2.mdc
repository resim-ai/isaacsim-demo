---
description: When a user wants to add emissions or metrics to their robotics system.
alwaysApply: false
---

## Overview
ReSim Metrics 2.0 is an exciting new feature that allows you to emit and dynamically query metrics from your system.
Metrics are emitted as JSON objects and stored in an `emissions.ndjson` file.
Topics and metrics are defined in the `.resim/metrics/config.yml` file.

## Topics
Topics define the data that is emitted from your system. They may contain a timestamp.
Items in the schema can have the following types:
- float
- string
- int
- image
- status
- string[]
- metric[]

Here are some example topics:
```
topics:
  time_to_goal:
    schema:
      time_s: float
      goal_name: string
  pose_difference:
    schema:
      position_diff_m: float
```

### Global topics

There are some topics that are global to all tests. Their schemas are below:

## metadata
```
metadata:
  schema:
    org_id: string
    batch_id: string
    job_id: string
    run_counter: int
    project_id: string
    experience_id: string
    experience_name: string
    experience_tag_ids: string[]
    experience_tag_names: string[]
    branch_id: string
    branch_name: string
    build_id: string
    build_name: string
    build_creation_timestamp: timestamp
    test_suite_id: string
    test_suite_name: string
    test_suite_revision: int
    job_status: string
    job_metrics_status: string
    job_conflated_status: string
```

## container_performance
```
container_performance:
  schema:
    org_id: string
    job_id: string
    batch_id: string
    timestamp_seconds: float # seconds since epoch
    container_name: string
    cpu_usage_core_seconds_per_sec: float
    cpu_throttling_seconds: float
    memory_usage_gib: float
    memory_limit_failures: float
    timestamp: float # nanoseconds since container start time
```

## test_length_seconds
```
test_length_seconds:
  schema:
    org_id: string
    job_id: string
    batch_id: string
    test_length: float
    timestamp: float
```

## Event topics
Event topics are marked by having the `event: true` field in the config.yml file.
The event topic always must have a schema like this:
```
schema:
  name: string
  description: string
  status: status
  tags: string[]
```
The status field is one of the following:
- PASSED
- FAIL_WARN
- FAIL_BLOCK
- NO_STATUS_REPORTED

## Metrics

Metrics are how we consume the data from the topics. Their primary components are a query and a template.
Here is an example of a metric:
```
metrics:
  Localization Error:
    type: test
    description: Difference in position between odometry and AMCL localization poses over time.
    query_string: SELECT 'Error', timestamp / 1E9 AS "Time (s)", position_diff_m as "Position Difference (m)" FROM pose_difference
    template_type: system
    template: line
```
The `query_string` is a SQL query in the Athena dialect. The template defines how the plot is rendered.
The `system` `line` and `bar` charts expect the query to return 3 columns: `group_name`, `x`, `y`. Hence, to display multiple series in the chart, you need an emissions with different `group_name`s. The names of the columns can be anything, but they must be in the order of `group_name`, `x`, `y`.
The `system` `scalar` chart expects the query to return 1 column: `value`.